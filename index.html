<!DOCTYPE html> 
<html> 
	<head> 
	<title>Tellcontroll</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		currentID="";
		
		$( '#index' ).live( 'pageinit',function(event){

			$.getJSON('../devices.json', function(data) {

				$.each(data.devices, function(key, value) { 
					$("#indexList").append('<li><a href="#controlPage-'+value.id+'">'+value.name+'</a></li>');
				});
				
				$('#indexList').listview('refresh');
				
			});
			
			$(document).bind( "pagebeforechange", function( e, data ) {

				if ( typeof data.toPage === "string" ) {

						var u = $.mobile.path.parseUrl( data.toPage );
						var id = u.hash.split('-')[1];
						if (id !== undefined){
							$.getJSON('../devices/'+id+'.json', function(data) {
								console.log(data);
							
								//create markup
								var newPage = $("<div id=\""+u.hash+"\" data-role=page data-url=\""+u.hash+"\"><div data-role=header><h1>"+data.name+"</h1></div><div data-role=content><fieldset class=\"ui-grid-a\"><div class=\"ui-block-a\"><button id=\"on\" type=\"submit\">ON</button></div><div class=\"ui-block-b\"><button id=\"off\" type=\"submit\">OFF</button></div></fieldset></div></div");

								//append it to the page container
								newPage.appendTo( $.mobile.pageContainer );
								
								//go to it
								$.mobile.changePage( newPage );
								
							});
						}
					}
			});
			
			function GetDeviceData(id){
				
			}
			
			function turnOn(){
				$.getJSON('../devices/'+getId()+'/on.json');
				
			}
			
			function turnOff(){
				$.getJSON('../devices/'+getId()+'/off.json');
			}
			
			function getId(){
				var id = $.mobile.activePage.attr('id').split('-')[1];

				return id
			}
			
			$("#off").click(function() {
			});
			
		});

	</script>
</head> 
<body> 

<div data-role="page" id="index">

	<div data-role="header">
		<h1>Tellcontroll</h1>
	</div>
	
	<div data-role="content">	
		<ul id="indexList" data-role="listview">
		</ul>

	</div>

</div>
</body>
</html>