<!DOCTYPE html> 
<html> 
	<head> 
	<title>Tellcontroll</title> 
	<meta name="viewport" content="width=device-width, initial-scale=1"> 
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.1.0-rc.1/jquery.mobile-1.1.0-rc.1.min.js"></script>
	<script type="text/javascript" charset="utf-8">
		currentID="";
		
		$( '#index' ).live( 'pageinit',function(event){

			$.getJSON('../devices.json', function(data) {

				$.each(data.devices, function(key, value) { 
					$("#indexList").append('<li><a href="#controlPage?'+value.id+'">'+value.name+'</a></li>');
				});
				
				$('#indexList').listview('refresh');
				
			});
			
			$(document).bind( "pagebeforechange", function( e, data ) {

				if ( typeof data.toPage === "string" ) {

						var u = $.mobile.path.parseUrl( data.toPage );
						console.log(u);
						var id = u.hash.split('?')[1];
						if (id !== undefined){
							$.getJSON('../devices/'+id+'.json', function(device) {
								console.log(device);
								$('#deviceName').text(device.name);
							});
						}
					}
			});
			
			function GetDeviceData(id){
				
			}
			
			function turnOn(){
				$.getJSON('../devices/'+getId()+'/on.json');
				
			}
			
			function turnOff(){
				$.getJSON('../devices/'+getId()+'/off.json');
			}
			
			function getId(){
				var id = $.mobile.activePage.attr('id').split('-')[1];

				return id
			}
			
			$("#off").click(function() {
			});
			
		});

	</script>
</head> 
<body> 

<div data-role="page" id="index">

	<div data-role="header">
		<h1>Tellcontroll</h1>
	</div>
	
	<div data-role="content">	
		<ul id="indexList" data-role="listview">
		</ul>

	</div>

</div>

<div data-role="page" id="controlPage" data-add-back-btn="true">

	<div data-role="header">
		<h1 id="deviceName"></h1>
	</div>

	<div data-role="content">	
	</div>
	
</div>

</body>
</html>